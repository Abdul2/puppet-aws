
# install puppet gem

sudo gem install puppet

# this will install the following gems:
# facter-2.4.4  hiera-3.0.1  json_pure-1.8.2  puppet-4.2.1
# in /var/lib/gems/1.9.1/gems/

sudo gem install aws-sdk-core retries

# this installs the following gems in /var/lib/gems/1.9.1/gems/
# aws-sdk-core-2.1.8  jmespath-1.0.2  multi_json-1.11.2  retries-0.0.5

mkdir ~/.aws
touch touch ~/.aws/credentials
# include the following text replacing key values

#[default]
#aws_access_key_id = your_access_key_id
#aws_secret_access_key = your_secret_access_key

# Install puppet module
puppet module install puppetlabs-aws
# module will be installed in ~/.puppetlabs/etc/code/modules/aws
# this folder contains examples to get you started.

# to stay in dublin
export AWS_REGION=eu-west-1

# test 
puppet resource ec2_instance # this should return the running instances. if you receive access credentials error, 
# export the key values

export AWS_ACCESS_KEY_ID=your_access_key_id
export AWS_SECRET_ACCESS_KEY=your_secret_access_key


# to create an instnace. create a create.pp file with current content:


ec2_instance { 'myinstance':
  ensure          => present,
  image_id        => 'ami-number', # replace as required
  region          => 'region-code', #replace with code e.g. eu-west-1
  instance_type   => 't2.micro', #replace as required
  tags            => { #include own tags
    department => 'dept',
    project    => 'finance',
    created_by => 'who?',
  }
}

# run puppet on file above

puppet apply create.pp

# loginto your aws console and see resource created

# deleting of the instance involves stopping it and terminating (two files)

# to stop - put the text below into a file_name.pp and run $ puppet apply file_name.pp

ec2_instance { 'myinstance':
  ensure   => 'stopped',
  region   => 'eu-west-1', # must have the region
}

# to terminate -put the text below into file_name.pp and run $puppet apply file_name.pp

ec2_instance { 'myintance':
  ensure   => 'absent',
  region   => 'eu-west-1', # must have the region
}





